<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shuttle Team Allocator</title>

<link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&display=swap" rel="stylesheet">

<style>
*{
    margin:0;
    padding:0;
    box-sizing:border-box;
    font-family:'Comic Neue', cursive;
}

body{
    min-height:100vh;
    background:url("https://images.pexels.com/photos/399187/pexels-photo-399187.jpeg?auto=compress&cs=tinysrgb&w=1920")
    no-repeat center center/cover;
    position:relative;
    color:white;
    display:flex;
    justify-content:center;
    align-items:center;
}

body::before{
    content:"";
    position:absolute;
    width:100%;
    height:100%;
    background:linear-gradient(to bottom, rgba(0,0,0,0.4), rgba(0,0,0,0.8));
}

.card{
    width:90%;
    max-width:650px;
    padding:40px 30px;
    border-radius:30px;
    backdrop-filter:blur(18px);
    background:rgba(0,0,0,0.35);
    border:1px solid rgba(255,255,255,0.2);
    box-shadow:0 10px 40px rgba(0,0,0,0.6);
    text-align:center;
}

.title{
    font-size:40px;
    margin-bottom:20px;
}

textarea{
    width:90%;
    height:120px;
    border-radius:15px;
    border:none;
    padding:12px;
    font-size:16px;
    margin-top:10px;
    resize:none;
}

button{
    margin-top:20px;
    padding:14px 30px;
    border:none;
    border-radius:30px;
    background:white;
    color:black;
    font-size:20px;
    cursor:pointer;
}

.teams{
    margin-top:25px;
    text-align:left;
}

.match{
    margin:8px 0;
    display:flex;
    justify-content:space-between;
    align-items:center;
}

select{
    border-radius:10px;
    padding:4px;
}

table{
    width:100%;
    margin-top:10px;
}

td,th{
    padding:6px;
}

#champion{
    display:flex;
    justify-content:center;
    width:100%;
}

.champion-box{
    margin:30px auto;
    padding:28px 32px;
    border-radius:22px;
    text-align:center;
    background:rgba(255,215,0,0.08);
    border:1px solid rgba(255,215,0,0.4);
    max-width:380px;
}

.trophy{
    font-size:60px;
}

.champion-text{
    font-size:20px;
    color:#ffd700;
}

.champion-name{
    font-size:46px;
    font-weight:bold;
    background:linear-gradient(90deg,#ffd700,#fff3a0);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    margin-top:8px;
}
</style>
</head>

<body>

<div class="card">

<div class="title">Shuttle Team Allocator</div>

<p>Enter Player Names (One per line)</p>

<textarea id="players" placeholder="Player1&#10;Player2&#10;Player3"></textarea>

<br>
<button onclick="allocateTeams()">Allocate Teams</button>

<div class="teams" id="teamOutput"></div>
<div class="teams" id="leagueOutput"></div>
<div class="teams" id="knockoutOutput"></div>
<div id="champion"></div>

</div>

<script>

let teamsGlobal=[];
let points={};
let leagueMatches=[];
let semiWinners=[];

function shuffle(arr){
    for(let i=arr.length-1;i>0;i--){
        let j=Math.floor(Math.random()*(i+1));
        [arr[i],arr[j]]=[arr[j],arr[i]];
    }
}

function safeId(name){
    return name.replace(/[^a-zA-Z0-9]/g,"");
}

function uniquePlayers(list){
    let seen=new Set();
    let result=[];
    list.forEach(p=>{
        let key=p.toLowerCase();
        if(!seen.has(key)){
            seen.add(key);
            result.push(p);
        }
    });
    return result;
}

function allocateTeams(){

    document.getElementById("champion").innerHTML="";

    let players=document.getElementById("players").value.trim()
        .split("\n")
        .map(p=>p.trim())
        .filter(p=>p!="");

    players=uniquePlayers(players);

    if(players.length<2) return;

    shuffle(players);

    teamsGlobal=[];
    points={};
    semiWinners=[];

    for(let i=0;i<players.length;i+=2){
        if(i+1<players.length)
            teamsGlobal.push([players[i],players[i+1]]);
        else
            teamsGlobal.push([players[i]]);
    }

    let html="<h3>Teams</h3><table><tr><th>Team</th><th>Points</th></tr>";

    teamsGlobal.forEach(t=>{
        let name=t.join(" & ");
        points[name]=0;
        html+=`<tr><td>${name}</td><td id="pt-${safeId(name)}">0</td></tr>`;
    });

    html+="</table>";
    document.getElementById("teamOutput").innerHTML=html;

    createLeague();
}

function createLeague(){

    leagueMatches=[];

    for(let i=0;i<teamsGlobal.length;i++){
        for(let j=i+1;j<teamsGlobal.length;j++){
            leagueMatches.push({A:teamsGlobal[i],B:teamsGlobal[j]});
        }
    }

    shuffle(leagueMatches);

    let html="<h3>League Matches</h3>";

    leagueMatches.forEach(m=>{
        let A=m.A.join(" & ");
        let B=m.B.join(" & ");

        html+=`
        <div class="match">
        ${m.A[0]} vs ${m.B[0]}
        <select onchange="updatePoints()">
            <option value="">Winner</option>
            <option value="${A}">${m.A[0]}</option>
            <option value="${B}">${m.B[0]}</option>
        </select>
        </div>`;
    });

    document.getElementById("leagueOutput").innerHTML=html;
}

function updatePoints(){

    for(let t in points) points[t]=0;

    document.querySelectorAll("#leagueOutput select").forEach(sel=>{
        if(sel.value) points[sel.value]++;
    });

    for(let t in points){
        document.getElementById("pt-"+safeId(t)).innerText=points[t];
    }

    if(teamsGlobal.length==2){
        let winner="";
        document.querySelectorAll("#leagueOutput select").forEach(sel=>{
            if(sel.value) winner=sel.value;
        });
        if(winner){
            selectChampion({value:winner});
        }
        return;
    }

    generateKnockouts();
}

function generateKnockouts(){

    let sorted=Object.entries(points).sort((a,b)=>b[1]-a[1]);
    let html="";

    if(teamsGlobal.length==3){

        if(sorted[0][1]==sorted[1][1] && sorted[1][1]==sorted[2][1]){
            let teams=[sorted[0][0],sorted[1][0],sorted[2][0]];
            shuffle(teams);
            html="<h3>Tie Break Match</h3>";
            html+=createTieBreak(teams[1],teams[2],teams[0]);
        }else{
            html="<h3>Final</h3>";
            html+=createFinal(sorted[0][0],sorted[1][0]);
        }
    }

    else if(teamsGlobal.length>=4){
        html="<h3>Semi Finals</h3>";
        html+=createSemi(sorted[0][0],sorted[3][0],0);
        html+=createSemi(sorted[1][0],sorted[2][0],1);
        html+=`<div id="finalSection"></div>`;
    }

    document.getElementById("knockoutOutput").innerHTML=html;
}

function createTieBreak(A,B,finalist){
    return `
    <div class="match">
    ${A.split(" & ")[0]} vs ${B.split(" & ")[0]}
    <select onchange="tieBreakWinner(this,'${finalist}')">
        <option value="">Winner</option>
        <option value="${A}">${A.split(" & ")[0]}</option>
        <option value="${B}">${B.split(" & ")[0]}</option>
    </select>
    </div>
    <div id="finalSection"></div>`;
}

function tieBreakWinner(sel,finalist){
    document.getElementById("finalSection").innerHTML=
    "<h3>Final</h3>"+createFinal(sel.value,finalist);
}

function createSemi(A,B,index){
    return `
    <div class="match">
    ${A.split(" & ")[0]} vs ${B.split(" & ")[0]}
    <select onchange="selectSemiWinner(${index},this)">
        <option value="">Winner</option>
        <option value="${A}">${A.split(" & ")[0]}</option>
        <option value="${B}">${B.split(" & ")[0]}</option>
    </select>
    </div>`;
}

function selectSemiWinner(index,sel){
    semiWinners[index]=sel.value;
    if(semiWinners[0] && semiWinners[1]){
        document.getElementById("finalSection").innerHTML=
        "<h3>Final</h3>"+createFinal(semiWinners[0],semiWinners[1]);
    }
}

function createFinal(A,B){
    return `
    <div class="match">
    ${A.split(" & ")[0]} vs ${B.split(" & ")[0]}
    <select onchange="selectChampion(this)">
        <option value="">Winner</option>
        <option value="${A}">${A.split(" & ")[0]}</option>
        <option value="${B}">${B.split(" & ")[0]}</option>
    </select>
    </div>`;
}

function selectChampion(sel){
    document.getElementById("champion").innerHTML=`
    <div class="champion-box">
        <div class="trophy">üèÜ</div>
        <div class="champion-text">CHAMPIONS</div>
        <div class="champion-name">${sel.value}</div>
    </div>`;
}

</script>

</body>
</html>
